function autosave_parse_response(a){var b=wpAjax.parseAjaxResponse(a,"autosave"),c="",d,e;if(b&&b.responses&&b.responses.length){c=b.responses[0].data;if(b.responses[0].supplemental){e=b.responses[0].supplemental;if("disable"==e.disable_autosave){autosave=function(){};autosaveLockRelease=!1;b={errors:!0}}e["active-post-lock"]&&jQuery("#active_post_lock").val(e["active-post-lock"]);if(e.alert){jQuery("#autosave-alert").remove();jQuery("#titlediv").after('<div id="autosave-alert" class="error below-h2"><p>'+e.alert+"</p></div>")}jQuery.each(e,function(a,b){a.match(/^replace-/)&&jQuery("#"+a.replace("replace-","")).val(b)})}if(!b.errors){d=parseInt(b.responses[0].id,10);!isNaN(d)&&d>0&&autosave_update_slug(d)}}c?jQuery(".autosave-message").html(c):autosaveOldMessage&&b&&jQuery(".autosave-message").html(autosaveOldMessage);return b}function autosave_saved(a){blockSave=!1;autosave_parse_response(a);autosave_enable_buttons()}function autosave_saved_new(a){blockSave=!1;var b=autosave_parse_response(a),c;if(b&&b.responses.length&&!b.errors){c=parseInt(b.responses[0].id,10);if(!isNaN(c)&&c>0){notSaved=!1;jQuery("#auto_draft").val("0")}autosave_enable_buttons();if(autosaveDelayPreview){autosaveDelayPreview=!1;doPreview()}}else autosave_enable_buttons()}function autosave_update_slug(a){"undefined"!=makeSlugeditClickable&&jQuery.isFunction(makeSlugeditClickable)&&!jQuery("#edit-slug-box > *").size()&&jQuery.post(ajaxurl,{action:"sample-permalink",post_id:a,new_title:fullscreen&&fullscreen.settings.visible?jQuery("#wp-fullscreen-title").val():jQuery("#title").val(),samplepermalinknonce:jQuery("#samplepermalinknonce").val()},function(a){if(a!=="-1"){jQuery("#edit-slug-box").html(a);makeSlugeditClickable()}})}function autosave_loading(){jQuery(".autosave-message").html(autosaveL10n.savingText)}function autosave_enable_buttons(){setTimeout(function(){jQuery(":button, :submit","#submitpost").removeAttr("disabled");jQuery(".ajax-loading").css("visibility","hidden")},500)}function autosave_disable_buttons(){jQuery(":button, :submit","#submitpost").prop("disabled",!0);setTimeout(autosave_enable_buttons,5e3)}function delayed_autosave(){setTimeout(function(){if(blockSave)return;autosave()},200)}var autosave,autosaveLast="",autosavePeriodical,autosaveOldMessage="",autosaveDelayPreview=!1,notSaved=!0,blockSave=!1,fullscreen,autosaveLockRelease=!0;jQuery(document).ready(function(a){var b=!0;autosaveLast=a("#post #title").val()+a("#post #content").val();autosavePeriodical=a.schedule({time:autosaveL10n.autosaveInterval*1e3,func:function(){autosave()},repeat:!0,protect:!0});a("#post").submit(function(){a.cancel(autosavePeriodical);autosaveLockRelease=!1});a('input[type="submit"], a.submitdelete',"#submitpost").click(function(){blockSave=!0;window.onbeforeunload=null;a(":button, :submit","#submitpost").each(function(){var b=a(this);b.hasClass("button-primary")?b.addClass("button-primary-disabled"):b.addClass("button-disabled")});a(this).attr("id")=="publish"?a("#ajax-loading").css("visibility","visible"):a("#draft-ajax-loading").css("visibility","visible")});window.onbeforeunload=function(){var b=typeof tinyMCE!="undefined"?tinyMCE.activeEditor:!1,c,d;if(b&&!b.isHidden()){if(b.isDirty())return autosaveL10n.saveAlert}else{if(fullscreen&&fullscreen.settings.visible){c=a("#wp-fullscreen-title").val();d=a("#wp_mce_fullscreen").val()}else{c=a("#post #title").val();d=a("#post #content").val()}if((c||d)&&c+d!=autosaveLast)return autosaveL10n.saveAlert}};a(window).unload(function(b){if(!autosaveLockRelease)return;if(b.target&&b.target.nodeName!="#document")return;a.ajax({type:"POST",url:ajaxurl,async:!1,data:{action:"wp-remove-post-lock",_wpnonce:a("#_wpnonce").val(),post_ID:a("#post_ID").val(),active_post_lock:a("#active_post_lock").val()}})});a("#post-preview").click(function(){if(a("#auto_draft").val()=="1"&&notSaved){autosaveDelayPreview=!0;autosave();return!1}doPreview();return!1});doPreview=function(){a("input#wp-preview").val("dopreview");a("form#post").attr("target","wp-preview").submit().attr("target","");a.browser.safari&&a("form#post").attr("action",function(a,b){return b+"?t="+(new Date).getTime()});a("input#wp-preview").val("")};typeof tinyMCE!="undefined"&&a("#title")[a.browser.opera?"keypress":"keydown"](function(c){if(c.which==9&&!c.shiftKey&&!c.controlKey&&!c.altKey){a("#auto_draft").val()=="1"&&a("#title").val().length>0&&autosave();if(tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden()&&b){c.preventDefault();b=!1;tinyMCE.activeEditor.focus();return!1}}});"1"==a("#auto_draft").val()&&a("#title").blur(function(){if(!this.value||a("#auto_draft").val()!="1")return;delayed_autosave()})});autosave=function(){blockSave=!0;var a=typeof tinyMCE!="undefined"&&tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden(),b,c,d,e,f;autosave_disable_buttons();b={action:"autosave",post_ID:jQuery("#post_ID").val()||0,autosavenonce:jQuery("#autosavenonce").val(),post_type:jQuery("#post_type").val()||"",autosave:1};jQuery(".tags-input").each(function(){b[this.name]=this.value});c=!0;jQuery("#TB_window").css("display")=="block"&&(c=!1);if(a&&c){d=tinyMCE.activeEditor;if(d.plugins.spellchecker&&d.plugins.spellchecker.active)c=!1;else{("mce_fullscreen"==d.id||"wp_mce_fullscreen"==d.id)&&tinyMCE.get("content").setContent(d.getContent({format:"raw"}),{format:"raw"});tinyMCE.triggerSave()}}if(fullscreen&&fullscreen.settings.visible){b.post_title=jQuery("#wp-fullscreen-title").val()||"";b.content=jQuery("#wp_mce_fullscreen").val()||""}else{b.post_title=jQuery("#title").val()||"";b.content=jQuery("#content").val()||""}jQuery("#post_name").val()&&(b.post_name=jQuery("#post_name").val());if(b.post_title.length==0&&b.content.length==0||b.post_title+b.content==autosaveLast)c=!1;e=jQuery("#original_post_status").val();goodcats=[];jQuery("[name='post_category[]']:checked").each(function(a){goodcats.push(this.value)});b.catslist=goodcats.join(",");jQuery("#comment_status").prop("checked")&&(b.comment_status="open");jQuery("#ping_status").prop("checked")&&(b.ping_status="open");jQuery("#excerpt").size()&&(b.excerpt=jQuery("#excerpt").val());jQuery("#post_author").size()&&(b.post_author=jQuery("#post_author").val());jQuery("#parent_id").val()&&(b.parent_id=jQuery("#parent_id").val());b.user_ID=jQuery("#user-id").val();jQuery("#auto_draft").val()=="1"&&(b.auto_draft="1");if(c){autosaveLast=b.post_title+b.content;jQuery(document).triggerHandler("wpcountwords",[b.content])}else b.autosave=0;b.auto_draft=="1"?f=autosave_saved_new:f=autosave_saved;autosaveOldMessage=jQuery("#autosave").html();jQuery.ajax({data:b,beforeSend:c?autosave_loading:null,type:"POST",url:ajaxurl,success:f})};