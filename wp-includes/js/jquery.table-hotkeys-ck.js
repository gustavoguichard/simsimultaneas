(function(a){a.fn.filter_visible=function(b){b=b||3;var c=function(){var c=a(this),d;for(d=0;d<b-1;++d){if(!c.is(":visible"))return!1;c=c.parent()}return!0};return this.filter(c)};a.table_hotkeys=function(b,c,d){d=a.extend(a.table_hotkeys.defaults,d);var e,f,g,h,i,j,k,l,m,n,o,p,q;e=d.class_prefix+d.selected_suffix;f=d.class_prefix+d.destructive_suffix;g=function(b){a.table_hotkeys.current_row&&a.table_hotkeys.current_row.removeClass(e);b.addClass(e);b[0].scrollIntoView(!1);a.table_hotkeys.current_row=b};h=function(b){!j(b)&&a.isFunction(d[b+"_page_link_cb"])&&d[b+"_page_link_cb"]()};i=function(b){var c,e;if(!a.table_hotkeys.current_row){c=n();a.table_hotkeys.current_row=c;return c[0]}e="prev"==b?a.fn.prevAll:a.fn.nextAll;return e.call(a.table_hotkeys.current_row,d.cycle_expr).filter_visible()[0]};j=function(b){var c=i(b);if(!c)return!1;g(a(c));return!0};k=function(){return j("prev")};l=function(){return j("next")};m=function(){a(d.checkbox_expr,a.table_hotkeys.current_row).each(function(){this.checked=!this.checked})};n=function(){return a(d.cycle_expr,b).filter_visible().eq(d.start_row_index)};o=function(){var c=a(d.cycle_expr,b).filter_visible();return c.eq(c.length-1)};p=function(b){return function(){if(null==a.table_hotkeys.current_row)return!1;var c=a(b,a.table_hotkeys.current_row);if(!c.length)return!1;c.is("."+f)&&(l()||k());c.click()}};q=n();if(!q.length)return;d.highlight_first?g(q):d.highlight_last&&g(o());a.hotkeys.add(d.prev_key,d.hotkeys_opts,function(){return h("prev")});a.hotkeys.add(d.next_key,d.hotkeys_opts,function(){return h("next")});a.hotkeys.add(d.mark_key,d.hotkeys_opts,m);a.each(c,function(){var b,c;if(a.isFunction(this[1])){b=this[1];c=this[0];a.hotkeys.add(c,d.hotkeys_opts,function(c){return b(c,a.table_hotkeys.current_row)})}else{c=this;a.hotkeys.add(c,d.hotkeys_opts,p("."+d.class_prefix+c))}})};a.table_hotkeys.current_row=null;a.table_hotkeys.defaults={cycle_expr:"tr",class_prefix:"vim-",selected_suffix:"current",destructive_suffix:"destructive",hotkeys_opts:{disableInInput:!0,type:"keypress"},checkbox_expr:":checkbox",next_key:"j",prev_key:"k",mark_key:"x",start_row_index:2,highlight_first:!1,highlight_last:!1,next_page_link_cb:!1,prev_page_link_cb:!1}})(jQuery);