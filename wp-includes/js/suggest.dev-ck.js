/*
 *	jquery.suggest 1.1b - 2007-08-06
 * Patched by Mark Jaquith with Alexander Dick's "multiple items" patch to allow for auto-suggesting of more than one tag before submitting
 * See: http://www.vulgarisoip.com/2007/06/29/jquerysuggest-an-alternative-jquery-based-autocomplete-library/#comment-7228
 *
 *	Uses code and techniques from following libraries:
 *	1. http://www.dyve.net/jquery/?autocomplete
 *	2. http://dev.jquery.com/browser/trunk/plugins/interface/iautocompleter.js
 *
 *	All the new stuff written by Peter Vulgaris (www.vulgarisoip.com)
 *	Feel free to do whatever you want with this file
 *
 */(function(a){a.suggest=function(b,c){function k(){var a=d.offset();e.css({top:a.top+b.offsetHeight+"px",left:a.left+"px"})}function l(a){if(/27$|38$|40$/.test(a.keyCode)&&e.is(":visible")||/^13$|^9$/.test(a.keyCode)&&r()){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();a.cancelBubble=!0;a.returnValue=!1;switch(a.keyCode){case 38:u();break;case 40:t();break;case 9:case 13:s();break;case 27:e.hide()}}else if(d.val().length!=g){f&&clearTimeout(f);f=setTimeout(m,c.delay);g=d.val().length}}function m(){var b=a.trim(d.val()),f,g;if(c.multiple){f=b.lastIndexOf(c.multipleSep);f!=-1&&(b=a.trim(b.substr(f+c.multipleSep.length)))}if(b.length>=c.minchars){cached=n(b);cached?p(cached.items):a.get(c.source,{q:b},function(a){e.hide();g=q(a,b);p(g);o(b,g,a.length)})}else e.hide()}function n(a){var b;for(b=0;b<h.length;b++)if(h[b]["q"]==a){h.unshift(h.splice(b,1)[0]);return h[0]}return!1}function o(a,b,d){var e;while(h.length&&i+d>c.maxCacheSize){e=h.pop();i-=e.size}h.push({q:a,size:d,items:b});i+=d}function p(b){var d="",f;if(!b)return;if(!b.length){e.hide();return}k();for(f=0;f<b.length;f++)d+="<li>"+b[f]+"</li>";e.html(d).show();e.children("li").mouseover(function(){e.children("li").removeClass(c.selectClass);a(this).addClass(c.selectClass)}).click(function(a){a.preventDefault();a.stopPropagation();s()})}function q(b,d){var e=[],f=b.split(c.delimiter),g,h;for(g=0;g<f.length;g++){h=a.trim(f[g]);if(h){h=h.replace(new RegExp(d,"ig"),function(a){return'<span class="'+c.matchClass+'">'+a+"</span>"});e[e.length]=h}}return e}function r(){var a;if(!e.is(":visible"))return!1;a=e.children("li."+c.selectClass);a.length||(a=!1);return a}function s(){$currentResult=r();if($currentResult){if(c.multiple){d.val().indexOf(c.multipleSep)!=-1?$currentVal=d.val().substr(0,d.val().lastIndexOf(c.multipleSep)+c.multipleSep.length):$currentVal="";d.val($currentVal+$currentResult.text()+c.multipleSep);d.focus()}else d.val($currentResult.text());e.hide();c.onSelect&&c.onSelect.apply(d[0])}}function t(){$currentResult=r();$currentResult?$currentResult.removeClass(c.selectClass).next().addClass(c.selectClass):e.children("li:first-child").addClass(c.selectClass)}function u(){var a=r();a?a.removeClass(c.selectClass).prev().addClass(c.selectClass):e.children("li:last-child").addClass(c.selectClass)}var d,e,f,g,h,i;d=a(b).attr("autocomplete","off");e=a(document.createElement("ul"));f=!1;g=0;h=[];i=0;e.addClass(c.resultsClass).appendTo("body");k();a(window).load(k).resize(k);d.blur(function(){setTimeout(function(){e.hide()},200)});if(a.browser.msie)try{e.bgiframe()}catch(j){}a.browser.mozilla?d.keypress(l):d.keydown(l)};a.fn.suggest=function(b,c){if(!b)return;c=c||{};c.multiple=c.multiple||!1;c.multipleSep=c.multipleSep||", ";c.source=b;c.delay=c.delay||100;c.resultsClass=c.resultsClass||"ac_results";c.selectClass=c.selectClass||"ac_over";c.matchClass=c.matchClass||"ac_match";c.minchars=c.minchars||2;c.delimiter=c.delimiter||"\n";c.onSelect=c.onSelect||!1;c.maxCacheSize=c.maxCacheSize||65536;this.each(function(){new a.suggest(this,c)});return this}})(jQuery);