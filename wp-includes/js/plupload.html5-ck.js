(function(a,b,c,d){function g(b,c){var d;if(!("FileReader"in a))return c(b.getAsDataURL());d=new FileReader;d.readAsDataURL(b);d.onload=function(){c(d.result)}}function h(b,c){var d;if(!("FileReader"in a))return c(b.getAsBinary());d=new FileReader;d.readAsBinaryString(b);d.onload=function(){c(d.result)}}function j(a,c,d,f){var h,i,j,k,n=this;g(e[a.id],function(e){h=b.createElement("canvas");h.style.display="none";b.body.appendChild(h);i=h.getContext("2d");j=new Image;j.onerror=j.onabort=function(){f({success:!1})};j.onload=function(){var b,g,x,y,z;c.width||(c.width=j.width);c.height||(c.height=j.height);k=Math.min(c.width/j.width,c.height/j.height);if(k<1||k===1&&d==="image/jpeg"){b=Math.round(j.width*k);g=Math.round(j.height*k);h.width=b;h.height=g;i.drawImage(j,0,0,b,g);if(d==="image/jpeg"){y=new l(atob(e.substring(e.indexOf("base64,")+7)));if(y.headers&&y.headers.length){z=new m;if(z.init(y.get("exif")[0])){z.setExif("PixelXDimension",b);z.setExif("PixelYDimension",g);y.set("exif",z.getBinary());n.hasEventListener("ExifData")&&n.trigger("ExifData",a,z.EXIF());n.hasEventListener("GpsData")&&n.trigger("GpsData",a,z.GPS())}}if(c.quality)try{e=h.toDataURL(d,c.quality/100)}catch(A){e=h.toDataURL(d)}}else e=h.toDataURL(d);e=e.substring(e.indexOf("base64,")+7);e=atob(e);if(y&&y.headers&&y.headers.length){e=y.restore(e);y.purge()}h.parentNode.removeChild(h);f({success:!0,data:e})}else f({success:!1})};j.src=e})}function k(){function c(c,d){var e=a?0:-8*(d-1),f=0,g;for(g=0;g<d;g++)f|=b.charCodeAt(c+g)<<Math.abs(e+g*8);return f}function e(a,c,d){var d=arguments.length===3?d:b.length-c-1;b=b.substr(0,c)+a+b.substr(d+c)}function f(b,c,d){var f="",g=a?0:-8*(d-1),h;for(h=0;h<d;h++)f+=String.fromCharCode(c>>Math.abs(g+h*8)&255);e(f,b,d)}var a=!1,b;return{II:function(b){if(b===d)return a;a=b},init:function(c){a=!1;b=c},SEGMENT:function(a,c,d){switch(arguments.length){case 1:return b.substr(a,b.length-a-1);case 2:return b.substr(a,c);case 3:e(d,a,c);break;default:return b}},BYTE:function(a){return c(a,1)},SHORT:function(a){return c(a,2)},LONG:function(a,b){if(b===d)return c(a,4);f(a,b,4)},SLONG:function(a){var b=c(a,4);return b>2147483647?b-4294967296:b},STRING:function(a,b){var d="";for(b+=a;a<b;a++)d+=String.fromCharCode(c(a,1));return d}}}function l(a){var b={65505:{app:"EXIF",name:"APP1",signature:"Exif\0"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\0"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\0"}},c=[],e,f,g=d,h=0,i;e=new k;e.init(a);if(e.SHORT(0)!==65496)return;f=2;i=Math.min(1048576,a.length);while(f<=i){g=e.SHORT(f);if(g>=65488&&g<=65495){f+=2;continue}if(g===65498||g===65497)break;h=e.SHORT(f+2)+2;b[g]&&e.STRING(f+4,b[g].signature.length)===b[g].signature&&c.push({hex:g,app:b[g].app.toUpperCase(),name:b[g].name.toUpperCase(),start:f,length:h,segment:e.SEGMENT(f,h)});f+=h}e.init(null);return{headers:c,restore:function(a){e.init(a);var b=new l(a);if(!b.headers)return!1;for(var d=b.headers.length;d>0;d--){var g=b.headers[d-1];e.SEGMENT(g.start,g.length,"")}b.purge();f=e.SHORT(2)==65504?4+e.SHORT(4):2;for(var d=0,h=c.length;d<h;d++){e.SEGMENT(f,0,c[d].segment);f+=c[d].length}return e.SEGMENT()},get:function(a){var b=[];for(var d=0,e=c.length;d<e;d++)c[d].app===a.toUpperCase()&&b.push(c[d].segment);return b},set:function(a,b){var d=[];typeof b=="string"?d.push(b):d=b;for(var e=ii=0,f=c.length;e<f;e++){if(c[e].app===a.toUpperCase()){c[e].segment=d[ii];c[e].length=d[ii].length;ii++}if(ii>=d.length)break}},purge:function(){c=[];e.init(null)}}}function m(){function g(b,c){var g=a.SHORT(b),h,i,j,k,l,m,n,p,r=[],s={};for(h=0;h<g;h++){n=m=b+12*h+2;j=c[a.SHORT(n)];if(j===d)continue;k=a.SHORT(n+=2);l=a.LONG(n+=2);n+=4;r=[];switch(k){case 1:case 7:l>4&&(n=a.LONG(n)+e.tiffHeader);for(i=0;i<l;i++)r[i]=a.BYTE(n+i);break;case 2:l>4&&(n=a.LONG(n)+e.tiffHeader);s[j]=a.STRING(n,l-1);continue;case 3:l>2&&(n=a.LONG(n)+e.tiffHeader);for(i=0;i<l;i++)r[i]=a.SHORT(n+i*2);break;case 4:l>1&&(n=a.LONG(n)+e.tiffHeader);for(i=0;i<l;i++)r[i]=a.LONG(n+i*4);break;case 5:n=a.LONG(n)+e.tiffHeader;for(i=0;i<l;i++)r[i]=a.LONG(n+i*4)/a.LONG(n+i*4+4);break;case 9:n=a.LONG(n)+e.tiffHeader;for(i=0;i<l;i++)r[i]=a.SLONG(n+i*4);break;case 10:n=a.LONG(n)+e.tiffHeader;for(i=0;i<l;i++)r[i]=a.SLONG(n+i*4)/a.SLONG(n+i*4+4);break;default:continue}p=l==1?r[0]:r;f.hasOwnProperty(j)&&typeof p!="object"?s[j]=f[j][p]:s[j]=p}return s}function h(){var c=d,f=e.tiffHeader;a.II(a.SHORT(f)==18761);if(a.SHORT(f+=2)!==42)return!1;e.IFD0=e.tiffHeader+a.LONG(f+=2);c=g(e.IFD0,b.tiff);e.exifIFD="ExifIFDPointer"in c?e.tiffHeader+c.ExifIFDPointer:d;e.gpsIFD="GPSInfoIFDPointer"in c?e.tiffHeader+c.GPSInfoIFDPointer:d;return!0}function j(c,d,f){var g,h,j,k=0;if(typeof d=="string"){var l=b[c.toLowerCase()];for(hex in l)if(l[hex]===d){d=hex;break}}g=e[c.toLowerCase()+"IFD"];h=a.SHORT(g);for(i=0;i<h;i++){j=g+12*i+2;if(a.SHORT(j)==d){k=j+8;break}}if(!k)return!1;a.LONG(k,f);return!0}var a,b,e={},f;a=new k;b={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}};f={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};return{init:function(b){e={tiffHeader:10};if(b===d||!b.length)return!1;a.init(b);return a.SHORT(0)===65505&&a.STRING(4,5).toUpperCase()==="EXIF\0"?h():!1},EXIF:function(){var a;a=g(e.exifIFD,b.exif);if(a.ExifVersion&&c.typeOf(a.ExifVersion)==="array"){for(var d=0,f="";d<a.ExifVersion.length;d++)f+=String.fromCharCode(a.ExifVersion[d]);a.ExifVersion=f}return a},GPS:function(){var a;a=g(e.gpsIFD,b.gps);a.GPSVersionID&&(a.GPSVersionID=a.GPSVersionID.join("."));return a},setExif:function(a,b){return a!=="PixelXDimension"&&a!=="PixelYDimension"?!1:j("exif",a,b)},getBinary:function(){return a.SEGMENT()}}}var e={},f;c.runtimes.Html5=c.addRuntime("html5",{getFeatures:function(){var d,e,g,h,i,j;e=g=i=j=!1;if(a.XMLHttpRequest){d=new XMLHttpRequest;g=!!d.upload;e=!!d.sendAsBinary||!!d.upload}if(e){h=!!(d.sendAsBinary||a.Uint8Array&&a.ArrayBuffer);i=!(!File||!File.prototype.getAsDataURL&&!a.FileReader||!h);j=!!File&&!!(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)}f=c.ua.safari&&c.ua.windows;return{html5:e,dragdrop:function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a}(),jpgresize:i,pngresize:i,multipart:i||!!a.FileReader||!!a.FormData,canSendBinary:h,cantSendBlobInFormData:!!(c.ua.gecko&&a.FormData&&a.FileReader&&!FileReader.prototype.readAsArrayBuffer),progress:g,chunks:j,multi_selection:!c.ua.safari||!c.ua.windows,triggerDialog:c.ua.gecko&&a.FormData||c.ua.webkit}},init:function(d,g){function l(a){var b,f,g=[],h,i={};for(f=0;f<a.length;f++){b=a[f];if(i[b.name])continue;i[b.name]=!0;h=c.guid();e[h]=b;g.push(new c.File(h,b.fileName||b.name,b.fileSize||b.size))}g.length&&d.trigger("FilesAdded",g)}var i,k;i=this.getFeatures();if(!i.html5){g({success:!1});return}d.bind("Init",function(a){var e,f,g=[],h,i,j=a.settings.filters,k,m,n=b.body,q;e=b.createElement("div");e.id=a.id+"_html5_container";c.extend(e.style,{position:"absolute",background:d.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:d.settings.shim_bgcolor?"":0});e.className="plupload html5";if(d.settings.container){n=b.getElementById(d.settings.container);c.getStyle(n,"position")==="static"&&(n.style.position="relative")}n.appendChild(e);a:for(h=0;h<j.length;h++){k=j[h].extensions.split(/,/);for(i=0;i<k.length;i++){if(k[i]==="*"){g=[];break a}m=c.mimeTypes[k[i]];m&&c.inArray(m,g)===-1&&g.push(m)}}e.innerHTML='<input id="'+d.id+'_html5"  style="font-size:999px" type="file" accept="'+g.join(",")+'" '+(d.settings.multi_selection&&d.features.multi_selection?'multiple="multiple"':"")+" />";e.scrollTop=100;q=b.getElementById(d.id+"_html5");a.features.triggerDialog?c.extend(q.style,{position:"absolute",width:"100%",height:"100%"}):c.extend(q.style,{cssFloat:"right",styleFloat:"right"});q.onchange=function(){l(this.files);this.value=""};f=b.getElementById(a.settings.browse_button);if(f){var r=a.settings.browse_button_hover,s=a.settings.browse_button_active,t=a.features.triggerDialog?f:e;if(r){c.addEvent(t,"mouseover",function(){c.addClass(f,r)},a.id);c.addEvent(t,"mouseout",function(){c.removeClass(f,r)},a.id)}if(s){c.addEvent(t,"mousedown",function(){c.addClass(f,s)},a.id);c.addEvent(b.body,"mouseup",function(){c.removeClass(f,s)},a.id)}a.features.triggerDialog&&c.addEvent(f,"click",function(c){var d=b.getElementById(a.id+"_html5");d&&!d.disabled&&d.click();c.preventDefault()},a.id)}});d.bind("PostInit",function(){var a=b.getElementById(d.settings.drop_element);if(a){if(f){c.addEvent(a,"dragenter",function(e){var f,g,h;f=b.getElementById(d.id+"_drop");if(!f){f=b.createElement("input");f.setAttribute("type","file");f.setAttribute("id",d.id+"_drop");f.setAttribute("multiple","multiple");c.addEvent(f,"change",function(){l(this.files);c.removeEvent(f,"change",d.id);f.parentNode.removeChild(f)},d.id);a.appendChild(f)}g=c.getPos(a,b.getElementById(d.settings.container));h=c.getSize(a);c.getStyle(a,"position")==="static"&&c.extend(a.style,{position:"relative"});c.extend(f.style,{position:"absolute",display:"block",top:0,left:0,width:h.w+"px",height:h.h+"px",opacity:0})},d.id);return}c.addEvent(a,"dragover",function(a){a.preventDefault()},d.id);c.addEvent(a,"drop",function(a){var b=a.dataTransfer;b&&b.files&&l(b.files);a.preventDefault()},d.id)}});d.bind("Refresh",function(a){var e,f,g,h,i;e=b.getElementById(d.settings.browse_button);if(e){f=c.getPos(e,b.getElementById(a.settings.container));g=c.getSize(e);h=b.getElementById(d.id+"_html5_container");c.extend(h.style,{top:f.y+"px",left:f.x+"px",width:g.w+"px",height:g.h+"px"});if(d.features.triggerDialog){c.getStyle(e,"position")==="static"&&c.extend(e.style,{position:"relative"});i=parseInt(c.getStyle(e,"z-index"),10);isNaN(i)&&(i=0);c.extend(e.style,{zIndex:i});c.extend(h.style,{zIndex:i-1})}}});d.bind("DisableBrowse",function(a,c){var d=b.getElementById(a.id+"_html5");d&&(d.disabled=c)});d.bind("CancelUpload",function(){k&&k.abort&&k.abort()});d.bind("UploadFile",function(b,d){function m(a,b,c){var d;if(!File.prototype.slice)return(d=File.prototype.webkitSlice||File.prototype.mozSlice)?d.call(a,b,c):null;try{a.slice();return a.slice(b,c)}catch(e){return a.slice(b,c-b)}}function o(e){function l(){function G(e){var f=0,j="----pluploadboundary"+c.guid(),m,p="--",v="\r\n",x="";k=new XMLHttpRequest;k.upload&&(k.upload.onprogress=function(a){d.loaded=Math.min(d.size,h+a.loaded-f);b.trigger("UploadProgress",d)});k.onreadystatechange=function(){var a,f;if(k.readyState==4&&b.state!==c.STOPPED){try{a=k.status}catch(i){a=0}if(a>=400)b.trigger("Error",{code:c.HTTP_ERROR,message:c.translate("HTTP Error."),file:d,status:a});else{if(r){f={chunk:g,chunks:r,response:k.responseText,status:a};b.trigger("ChunkUploaded",d,f);h+=y;if(f.cancelled){d.status=c.FAILED;return}d.loaded=Math.min(d.size,(g+1)*w)}else d.loaded=d.size;b.trigger("UploadProgress",d);e=o=m=x=null;if(!r||++g>=r){d.status=c.DONE;b.trigger("FileUploaded",d,{response:k.responseText,status:a})}else l()}}};if(b.settings.multipart&&i.multipart){t.name=d.target_name||d.name;k.open("post",F,!0);c.each(b.settings.headers,function(a,b){k.setRequestHeader(b,a)});if(typeof e!="string"&&!!a.FormData){m=new FormData;c.each(c.extend(t,b.settings.multipart_params),function(a,b){m.append(b,a)});m.append(b.settings.file_data_name,e);k.send(m);return}if(typeof e=="string"){k.setRequestHeader("Content-Type","multipart/form-data; boundary="+j);c.each(c.extend(t,b.settings.multipart_params),function(a,b){x+=p+j+v+'Content-Disposition: form-data; name="'+b+'"'+v+v;x+=unescape(encodeURIComponent(a))+v});E=c.mimeTypes[d.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream";x+=p+j+v+'Content-Disposition: form-data; name="'+b.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(d.name))+'"'+v+"Content-Type: "+E+v+v+e+v+p+j+p+v;f=x.length-e.length;e=x;if(k.sendAsBinary)k.sendAsBinary(e);else if(i.canSendBinary){var z=new Uint8Array(e.length);for(var A=0;A<e.length;A++)z[A]=e.charCodeAt(A)&255;k.send(z.buffer)}return}}F=c.buildUrl(b.settings.url,c.extend(t,b.settings.multipart_params));k.open("post",F,!0);k.setRequestHeader("Content-Type","application/octet-stream");c.each(b.settings.headers,function(a,b){k.setRequestHeader(b,a)});k.send(e)}var o,p,r,t,w,y,E,F=b.settings.url;if(d.status==c.DONE||d.status==c.FAILED||b.state==c.STOPPED)return;t={name:d.target_name||d.name};if(f.chunk_size&&d.size>f.chunk_size&&(i.chunks||typeof e=="string")){w=f.chunk_size;r=Math.ceil(d.size/w);y=Math.min(w,d.size-g*w);typeof e=="string"?o=e.substring(g*w,g*w+y):o=m(e,g*w,g*w+y);t.chunk=g;t.chunks=r}else{y=d.size;o=e}if(b.settings.multipart&&i.multipart&&typeof o!="string"&&j&&i.cantSendBlobInFormData&&i.chunks&&b.settings.chunk_size){j.onload=function(){G(j.result)};j.readAsBinaryString(o)}else G(o)}var g=0,h=0,j="FileReader"in a?new FileReader:null;l()}var f=b.settings,g,l;g=e[d.id];i.jpgresize&&b.settings.resize&&/\.(png|jpg|jpeg)$/i.test(d.name)?j.call(b,d,b.settings.resize,/\.png$/i.test(d.name)?"image/png":"image/jpeg",function(a){if(a.success){d.size=a.data.length;o(a.data)}else i.chunks?o(g):h(g,o)}):!i.chunks&&i.jpgresize?h(g,o):o(g)});d.bind("Destroy",function(a){var d,e,f=b.body,g={inputContainer:a.id+"_html5_container",inputFile:a.id+"_html5",browseButton:a.settings.browse_button,dropElm:a.settings.drop_element};for(d in g){e=b.getElementById(g[d]);e&&c.removeAllEvents(e,a.id)}c.removeAllEvents(b.body,a.id);a.settings.container&&(f=b.getElementById(a.settings.container));f.removeChild(b.getElementById(g.inputContainer))});g({success:!0})}})})(window,document,plupload);