var theList,theExtraList,toggleWithKeyboard=!1;(function(a){var b,c,d,e;setCommentsList=function(){var f,g,h,i=0,j,k,l,m,n;f=a('input[name="_total"]',"#comments-form");g=a('input[name="_per_page"]',"#comments-form");h=a('input[name="_page"]',"#comments-form");j=function(b,c){var e=a("#"+c.element),f,g,h;f=a("#replyrow");g=a("#comment_ID",f).val();h=a("#replybtn",f);if(e.is(".unapproved")){c.data.id==g&&h.text(adminCommentsL10n.replyApprove);e.find("div.comment_status").html("0")}else{c.data.id==g&&h.text(adminCommentsL10n.reply);e.find("div.comment_status").html("1")}var i=a("#"+c.element).is("."+c.dimClass)?1:-1;d(i)};k=function(b,c){var d=a(b.target).attr("class"),e,i,j,k,l,m,n=!1;b.data._total=f.val()||0;b.data._per_page=g.val()||0;b.data._page=h.val()||0;b.data._url=document.location.href;b.data.comment_status=a('input[name="comment_status"]',"#comments-form").val();d.indexOf(":trash=1")!=-1?n="trash":d.indexOf(":spam=1")!=-1&&(n="spam");if(n){e=d.replace(/.*?comment-([0-9]+).*/,"$1");i=a("#comment-"+e);note=a("#"+n+"-undo-holder").html();i.find(".check-column :checkbox").prop("checked",!1);i.siblings("#replyrow").length&&commentReply.cid==e&&commentReply.close();if(i.is("tr")){j=i.children(":visible").length;m=a(".author strong",i).text();k=a('<tr id="undo-'+e+'" class="undo un'+n+'" style="display:none;"><td colspan="'+j+'">'+note+"</td></tr>")}else{m=a(".comment-author",i).text();k=a('<div id="undo-'+e+'" style="display:none;" class="undo un'+n+'">'+note+"</div>")}i.before(k);a("strong","#undo-"+e).text(m);l=a(".undo a","#undo-"+e);l.attr("href","comment.php?action=un"+n+"comment&c="+e+"&_wpnonce="+b.data._ajax_nonce);l.attr("class","delete:the-comment-list:comment-"+e+"::un"+n+"=1 vim-z vim-destructive");a(".avatar",i).clone().prependTo("#undo-"+e+" ."+n+"-undo-inside");l.click(function(){c.wpList.del(this);a("#undo-"+e).css({backgroundColor:"#ceb"}).fadeOut(350,function(){a(this).remove();a("#comment-"+e).css("backgroundColor","").fadeIn(300,function(){a(this).show()})});return!1})}return b};l=function(a,b,c){if(b<i)return;c&&(i=b);f.val(a.toString())};e=function(d){var e=a("#dashboard_right_now"),f,g,h,i;d=d||0;if(isNaN(d)||!e.length)return;f=a("span.total-count",e);g=a("span.approved-count",e);h=b(f);h+=d;i=h-b(a("span.pending-count",e))-b(a("span.spam-count",e));c(f,h);c(g,i)};b=function(a){var b=parseInt(a.html().replace(/[^0-9]+/g,""),10);return isNaN(b)?0:b};c=function(a,b){var c="";if(isNaN(b))return;b=b<1?"0":b.toString();if(b.length>3){while(b.length>3){c=thousandsSeparator+b.substr(b.length-3)+c;b=b.substr(0,b.length-3)}b+=c}a.html(b)};d=function(d){a("span.pending-count").each(function(){var e=a(this),f=b(e)+d;f<1&&(f=0);e.closest(".awaiting-mod")[0==f?"addClass":"removeClass"]("count-0");c(e,f)});e()};m=function(g,h){function t(b){return a(h.target).parent().is("span."+b)?1:a("#"+h.element).is("."+b)?-1:0}var j,k,m,o,p,q=a(h.target).parent().is("span.untrash"),r=a(h.target).parent().is("span.unspam"),s=a("#"+h.element).is(".unapproved");q?o=-1:o=t("trash");r?m=-1:m=t("spam");a(h.target).parent().is("span.unapprove")||(q||r)&&s?p=1:s&&(p=-1);p&&d(p);a("span.spam-count").each(function(){var d=a(this),e=b(d)+m;c(d,e)});a("span.trash-count").each(function(){var d=a(this),e=b(d)+o;c(d,e)});if(a("#dashboard_right_now").length){k=o?-1*o:0;e(k)}else{j=f.val()?parseInt(f.val(),10):0;a(h.target).parent().is("span.undo")?j++:j--;j<0&&(j=0);if("object"==typeof g&&i<h.parsed.responses[0].supplemental.time){total_items_i18n=h.parsed.responses[0].supplemental.total_items_i18n||"";if(total_items_i18n){a(".displaying-num").text(total_items_i18n);a(".total-pages").text(h.parsed.responses[0].supplemental.total_pages_i18n);a(".tablenav-pages").find(".next-page, .last-page").toggleClass("disabled",h.parsed.responses[0].supplemental.total_pages==a(".current-page").val())}l(j,h.parsed.responses[0].supplemental.time,!0)}else l(j,g,!1)}if(!theExtraList||theExtraList.size()==0||theExtraList.children().size()==0||q||r)return;theList.get(0).wpList.add(theExtraList.children(":eq(0)").remove().clone());n()};n=function(b){var c=a.query.get(),d=a(".total-pages").text(),e=a('input[name="_per_page"]',"#comments-form").val();c.paged||(c.paged=1);if(c.paged>d)return;if(b){theExtraList.empty();c.number=Math.min(8,e)}else{c.number=1;c.offset=Math.min(8,e)-1}c.no_placeholder=!0;c.paged++;!0===c.comment_type&&(c.comment_type="");c=a.extend(c,{action:"fetch-list",list_args:list_args,_ajax_fetch_list_nonce:a("#_ajax_fetch_list_nonce").val()});a.ajax({url:ajaxurl,global:!1,dataType:"json",data:c,success:function(a){theExtraList.get(0).wpList.add(a.rows)}})};theExtraList=a("#the-extra-comment-list").wpList({alt:"",delColor:"none",addColor:"none"});theList=a("#the-comment-list").wpList({alt:"",delBefore:k,dimAfter:j,delAfter:m,addColor:"none"}).bind("wpListDelEnd",function(b,c){var d=c.element.replace(/[^0-9]+/g,"");(c.target.className.indexOf(":trash=1")!=-1||c.target.className.indexOf(":spam=1")!=-1)&&a("#undo-"+d).fadeIn(300,function(){a(this).show()})})};commentReply={cid:"",act:"",init:function(){var b=a("#replyrow");a("a.cancel",b).click(function(){return commentReply.revert()});a("a.save",b).click(function(){return commentReply.send()});a("input#author, input#author-email, input#author-url",b).keypress(function(a){if(a.which==13){commentReply.send();a.preventDefault();return!1}});a("#the-comment-list .column-comment > p").dblclick(function(){commentReply.toggle(a(this).parent())});a("#doaction, #doaction2, #post-query-submit").click(function(b){a("#the-comment-list #replyrow").length>0&&commentReply.close()});this.comments_listing=a('#comments-form > input[name="comment_status"]').val()||""},addEvents:function(b){b.each(function(){a(this).find(".column-comment > p").dblclick(function(){commentReply.toggle(a(this).parent())})})},toggle:function(b){a(b).css("display")!="none"&&a(b).find("a.vim-q").click()},revert:function(){if(a("#the-comment-list #replyrow").length<1)return!1;a("#replyrow").fadeOut("fast",function(){commentReply.close()});return!1},close:function(){var b,c=a("#replyrow");if(c.parent().is("#com-reply"))return;if(this.cid&&this.act=="edit-comment"){b=a("#comment-"+this.cid);b.fadeIn(300,function(){b.show()}).css("backgroundColor","")}typeof QTags!="undefined"&&QTags.closeAllTags("replycontent");a("#add-new-comment").css("display","");c.hide();a("#com-reply").append(c);a("#replycontent").css("height","").val("");a("#edithead input").val("");a(".error",c).html("").hide();a(".waiting",c).hide();this.cid=""},open:function(b,c,d){var e=this,f,g,h,i=a("#comment-"+b),j=i.height(),k;e.close();e.cid=b;f=a("#replyrow");g=a("#inline-"+b);d=d||"replyto";h="edit"==d?"edit":"replyto";h=e.act=h+"-comment";a("#action",f).val(h);a("#comment_post_ID",f).val(c);a("#comment_ID",f).val(b);j>120&&a("#replycontent",f).css("height",35+j+"px");if(d=="edit"){a("#author",f).val(a("div.author",g).text());a("#author-email",f).val(a("div.author-email",g).text());a("#author-url",f).val(a("div.author-url",g).text());a("#status",f).val(a("div.comment_status",g).text());a("#replycontent",f).val(a("textarea.comment",g).val());a("#edithead, #savebtn",f).show();a("#replyhead, #replybtn, #addhead, #addbtn",f).hide();i.after(f).fadeOut("fast",function(){a("#replyrow").fadeIn(300,function(){a(this).show()})})}else if(d=="add"){a("#addhead, #addbtn",f).show();a("#replyhead, #replybtn, #edithead, #editbtn",f).hide();a("#the-comment-list").prepend(f);a("#replyrow").fadeIn(300)}else{k=a("#replybtn",f);a("#edithead, #savebtn, #addhead, #addbtn",f).hide();a("#replyhead, #replybtn",f).show();i.after(f);i.hasClass("unapproved")?k.text(adminCommentsL10n.replyApprove):k.text(adminCommentsL10n.reply);a("#replyrow").fadeIn(300,function(){a(this).show()})}setTimeout(function(){var b,c,d,e,f;b=a("#replyrow").offset().top;c=b+a("#replyrow").height();d=window.pageYOffset||document.documentElement.scrollTop;e=document.documentElement.clientHeight||self.innerHeight||0;f=d+e;f-20<c?window.scroll(0,c-e+35):b-20<d&&window.scroll(0,b-35);a("#replycontent").focus().keyup(function(a){a.which==27&&commentReply.revert()})},600);return!1},send:function(){var b={};a("#replysubmit .error").hide();a("#replysubmit .waiting").show();a("#replyrow input").not(":button").each(function(){var c=a(this);b[c.attr("name")]=c.val()});b.content=a("#replycontent").val();b.id=b.comment_post_ID;b.comments_listing=this.comments_listing;b.p=a('[name="p"]').val();a("#comment-"+a("#comment_ID").val()).hasClass("unapproved")&&(b.approve_parent=1);a.ajax({type:"POST",url:ajaxurl,data:b,success:function(a){commentReply.show(a)},error:function(a){commentReply.error(a)}});return!1},show:function(b){var c=this,e,f,g,h,i;if(typeof b=="string"){c.error({responseText:b});return!1}e=wpAjax.parseAjaxResponse(b);if(e.errors){c.error({responseText:wpAjax.broken});return!1}c.revert();e=e.responses[0];f=e.data;g="#comment-"+e.id;"edit-comment"==c.act&&a(g).remove();if(e.supplemental.parent_approved){i=a("#comment-"+e.supplemental.parent_approved);d(-1);if(this.comments_listing=="moderated"){i.animate({backgroundColor:"#CCEEBB"},400,function(){i.fadeOut()});return}}a(f).hide();a("#replyrow").after(f);g=a(g);c.addEvents(g);h=g.hasClass("unapproved")?"#FFFFE0":g.closest(".widefat, .postbox").css("backgroundColor");g.animate({backgroundColor:"#CCEEBB"},300).animate({backgroundColor:h},300,function(){i&&i.length&&i.animate({backgroundColor:"#CCEEBB"},300).animate({backgroundColor:h},300).removeClass("unapproved").addClass("approved").find("div.comment_status").html("1")})},error:function(b){var c=b.statusText;a("#replysubmit .waiting").hide();b.responseText&&(c=b.responseText.replace(/<.[^<>]*?>/g,""));c&&a("#replysubmit .error").html(c).show()},addcomment:function(b){var c=this;a("#add-new-comment").fadeOut(200,function(){c.open(0,b,"add");a("table.comments-box").css("display","");a("#no-comments").remove()})}};a(document).ready(function(){var b,c,d,e;setCommentsList();commentReply.init();a(document).delegate("span.delete a.delete","click",function(){return!1});if(typeof a.table_hotkeys!="undefined"){b=function(b){return function(){var c,d;c="next"==b?"first":"last";d=a(".tablenav-pages ."+b+"-page:not(.disabled)");d.length&&(window.location=d[0].href.replace(/\&hotkeys_highlight_(first|last)=1/g,"")+"&hotkeys_highlight_"+c+"=1")}};c=function(b,c){window.location=a("span.edit a",c).attr("href")};d=function(){toggleWithKeyboard=!0;a("input:checkbox","#cb").click().prop("checked",!1);toggleWithKeyboard=!1};e=function(b){return function(){var c=a('select[name="action"]');a('option[value="'+b+'"]',c).prop("selected",!0);a("#doaction").click()}};a.table_hotkeys(a("table.widefat"),["a","u","s","d","r","q","z",["e",c],["shift+x",d],["shift+a",e("approve")],["shift+s",e("spam")],["shift+d",e("delete")],["shift+t",e("trash")],["shift+z",e("untrash")],["shift+u",e("unapprove")]],{highlight_first:adminCommentsL10n.hotkeys_highlight_first,highlight_last:adminCommentsL10n.hotkeys_highlight_last,prev_page_link_cb:b("prev"),next_page_link_cb:b("next")})}})})(jQuery);