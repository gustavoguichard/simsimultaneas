/**
 * Theme Browsing
 *
 * Controls visibility of theme details on manage and install themes pages.
 */jQuery(function(a){a("#availablethemes").on("click",".theme-detail",function(b){var c=a(this).closest(".available-theme"),d=c.find(".themedetaildiv");if(!d.length){d=c.find(".install-theme-info .theme-details");d=d.clone().addClass("themedetaildiv").appendTo(c).hide()}d.toggle();b.preventDefault()})});jQuery(function(a){if(!window.postMessage)return;var b=a("#theme-installer"),c=b.find(".install-theme-info"),d=b.find(".wp-full-overlay-main"),e=a(document.body);b.on("click",".close-full-overlay",function(a){b.fadeOut(200,function(){d.empty();e.removeClass("theme-installer-active full-overlay-active")});a.preventDefault()});b.on("click",".collapse-sidebar",function(a){b.toggleClass("collapsed").toggleClass("expanded");a.preventDefault()});a("#availablethemes").on("click",".install-theme-preview",function(f){var g;c.html(a(this).closest(".installable-theme").find(".install-theme-info").html());g=c.find(".theme-preview-url").val();d.html('<iframe src="'+g+'" />');b.fadeIn(200,function(){e.addClass("theme-installer-active full-overlay-active")});f.preventDefault()})});var ThemeViewer;(function(a){ThemeViewer=function(b){function c(){a("#filter-click, #mini-filter-click").unbind("click").click(function(){a("#filter-click").toggleClass("current");a("#filter-box").slideToggle();a("#current-theme").slideToggle(300);return!1});a("#filter-box :checkbox").unbind("click").click(function(){var b=a("#filter-box :checked").length,c=a("#filter-click").text();c.indexOf("(")!=-1&&(c=c.substr(0,c.indexOf("(")));b==0?a("#filter-click").text(c):a("#filter-click").text(c+" ("+b+")")})}var d={init:c};return d}})(jQuery);jQuery(document).ready(function(a){theme_viewer=new ThemeViewer;theme_viewer.init()});var ThemeScroller;(function(a){ThemeScroller={querying:!1,scrollPollingDelay:500,failedRetryDelay:4e3,outListBottomThreshold:300,init:function(){var b=this;if(typeof ajaxurl=="undefined"||typeof list_args=="undefined"||typeof theme_list_args=="undefined"){a(".pagination-links").show();return}this.nonce=a("#_ajax_fetch_list_nonce").val();this.nextPage=theme_list_args.paged+1;this.$outList=a("#availablethemes");this.$spinner=a("div.tablenav.bottom").children("img.ajax-loading");this.$window=a(window);this.$document=a(document);theme_list_args.total_pages>=this.nextPage&&(this.pollInterval=setInterval(function(){return b.poll()},this.scrollPollingDelay))},poll:function(){var a=this.$document.scrollTop()+this.$window.innerHeight();if(this.querying||a<this.$outList.height()-this.outListBottomThreshold)return;this.ajax()},process:function(a){if(a===undefined){clearInterval(this.pollInterval);return}this.nextPage>theme_list_args.total_pages&&clearInterval(this.pollInterval);this.nextPage<=theme_list_args.total_pages+1&&this.$outList.append(a.rows)},ajax:function(){var b=this;this.querying=!0;var c={action:"fetch-list",paged:this.nextPage,s:theme_list_args.search,tab:theme_list_args.tab,type:theme_list_args.type,_ajax_fetch_list_nonce:this.nonce,"features[]":theme_list_args.features,list_args:list_args};this.$spinner.css("visibility","visible");a.getJSON(ajaxurl,c).done(function(a){b.nextPage++;b.process(a);b.$spinner.css("visibility","hidden");b.querying=!1}).fail(function(){b.$spinner.css("visibility","hidden");b.querying=!1;setTimeout(function(){b.ajax()},b.failedRetryDelay)})}};a(document).ready(function(a){ThemeScroller.init()})})(jQuery);