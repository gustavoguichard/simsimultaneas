var postboxes;(function(a){postboxes={add_postbox_toggles:function(b,c){var d=this;d.init(b,c);a(".postbox h3, .postbox .handlediv").bind("click.postboxes",function(){var c=a(this).parent(".postbox"),e=c.attr("id");if("dashboard_browser_nag"==e)return;c.toggleClass("closed");b!="press-this"&&d.save_state(b);e&&(!c.hasClass("closed")&&a.isFunction(postboxes.pbshow)?d.pbshow(e):c.hasClass("closed")&&a.isFunction(postboxes.pbhide)&&d.pbhide(e))});a(".postbox h3 a").click(function(a){a.stopPropagation()});a(".postbox a.dismiss").bind("click.postboxes",function(b){var c=a(this).parents(".postbox").attr("id")+"-hide";a("#"+c).prop("checked",!1).triggerHandler("click");return!1});a(".hide-postbox-tog").bind("click.postboxes",function(){var c=a(this).val();if(a(this).prop("checked")){a("#"+c).show();a.isFunction(postboxes.pbshow)&&d.pbshow(c)}else{a("#"+c).hide();a.isFunction(postboxes.pbhide)&&d.pbhide(c)}d.save_state(b);d._mark_area()});a('.columns-prefs input[type="radio"]').bind("click.postboxes",function(){var c=parseInt(a(this).val(),10);if(c){d._pb_edit(c);d.save_order(b)}})},init:function(b,c){var d=a(document.body).hasClass("mobile");a.extend(this,c||{});a("#wpbody-content").css("overflow","hidden");a(".meta-box-sortables").sortable({placeholder:"sortable-placeholder",connectWith:".meta-box-sortables",items:".postbox",handle:".hndle",cursor:"move",delay:d?200:0,distance:2,tolerance:"pointer",forcePlaceholderSize:!0,helper:"clone",opacity:.65,stop:function(c,d){if(a(this).find("#dashboard_browser_nag").is(":visible")&&"dashboard_browser_nag"!=this.firstChild.id){a(this).sortable("cancel");return}postboxes.save_order(b)},receive:function(b,c){"dashboard_browser_nag"==c.item[0].id&&a(c.sender).sortable("cancel");postboxes._mark_area()}});if(d){a(document.body).bind("orientationchange.postboxes",function(){postboxes._pb_change()});this._pb_change()}this._mark_area()},save_state:function(b){var c=a(".postbox").filter(".closed").map(function(){return this.id}).get().join(","),d=a(".postbox").filter(":hidden").map(function(){return this.id}).get().join(",");a.post(ajaxurl,{action:"closed-postboxes",closed:c,hidden:d,closedpostboxesnonce:jQuery("#closedpostboxesnonce").val(),page:b})},save_order:function(b){var c,d=a(".columns-prefs input:checked").val()||0;c={action:"meta-box-order",_ajax_nonce:a("#meta-box-order-nonce").val(),page_columns:d,page:b};a(".meta-box-sortables").each(function(){c["order["+this.id.split("-")[0]+"]"]=a(this).sortable("toArray").join(",")});a.post(ajaxurl,c)},_mark_area:function(){var b=a("div.postbox:visible").length,c=a("#post-body #side-sortables");a("#dashboard-widgets .meta-box-sortables:visible").each(function(c,d){var e=a(this);b==1||e.children(".postbox:visible").length?e.removeClass("empty-container"):e.addClass("empty-container")});c.length&&(c.children(".postbox:visible").length?c.removeClass("empty-container"):a("#postbox-container-1").css("width")=="280px"&&c.addClass("empty-container"))},_pb_edit:function(b){var c=a(".metabox-holder").get(0);c.className=c.className.replace(/columns-\d+/,"columns-"+b)},_pb_change:function(){switch(window.orientation){case 90:case-90:this._pb_edit(2);break;case 0:case 180:a("#poststuff").length?this._pb_edit(1):this._pb_edit(2)}},pbshow:!1,pbhide:!1}})(jQuery);